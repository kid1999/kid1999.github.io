<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>区块链基础 | Kid1999' Blog</title><meta name="keywords" content="BTC,ETH"><meta name="author" content="kid1999"><meta name="copyright" content="kid1999"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文的区块链相关知识，主要基于北京大学肖臻老师的《区块链技术与应用》总结。  区块链基础目录比特币部分 密码学基础 比特币的数据结构 共识协议和系统实现 挖矿算法及难度调节 比特币脚本 软分叉和硬分叉 匿名与隐私保护  以太坊部分 概述：基于账户的分布式账本 数据结构（MPT）：状态树、交易树、收据树 GHOST协议：对非主链区块的补偿 挖矿：memory hard mining puzzle">
<meta property="og:type" content="article">
<meta property="og:title" content="区块链基础">
<meta property="og:url" content="http://kid1999.github.io/2021/06/18/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="Kid1999&#39; Blog">
<meta property="og:description" content="本文的区块链相关知识，主要基于北京大学肖臻老师的《区块链技术与应用》总结。  区块链基础目录比特币部分 密码学基础 比特币的数据结构 共识协议和系统实现 挖矿算法及难度调节 比特币脚本 软分叉和硬分叉 匿名与隐私保护  以太坊部分 概述：基于账户的分布式账本 数据结构（MPT）：状态树、交易树、收据树 GHOST协议：对非主链区块的补偿 挖矿：memory hard mining puzzle">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://puui.qpic.cn/fans_admin/0/3_1680187318_1573908333220/0">
<meta property="article:published_time" content="2021-06-18T12:48:27.000Z">
<meta property="article:modified_time" content="2021-06-18T12:48:27.000Z">
<meta property="article:author" content="kid1999">
<meta property="article:tag" content="BTC">
<meta property="article:tag" content="ETH">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://puui.qpic.cn/fans_admin/0/3_1680187318_1573908333220/0"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://kid1999.github.io/2021/06/18/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="google-site-verification=1QTg0QaNHFPMhpyEbi6sCIR6Po-bAsEjy0UCeBQ90Nc"/><meta name="baidu-site-verification" content="code-STtYsRDbhz"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=google-site-verification=1QTg0QaNHFPMhpyEbi6sCIR6Po-bAsEjy0UCeBQ90Nc"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'google-site-verification=1QTg0QaNHFPMhpyEbi6sCIR6Po-bAsEjy0UCeBQ90Nc');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '区块链基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-06-18 20:48:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://ae01.alicdn.com/kf/H340f46b2cafd47248f643b32d3629cc3d.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">111</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">85</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://puui.qpic.cn/fans_admin/0/3_1680187318_1573908333220/0')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Kid1999' Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">区块链基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-18T12:48:27.000Z" title="发表于 2021-06-18 20:48:27">2021-06-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-06-18T12:48:27.000Z" title="更新于 2021-06-18 20:48:27">2021-06-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="区块链基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>本文的区块链相关知识，主要基于北京大学肖臻老师的《区块链技术与应用》总结。</p>
</blockquote>
<h1 id="区块链基础"><a href="#区块链基础" class="headerlink" title="区块链基础"></a>区块链基础</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h4 id="比特币部分"><a href="#比特币部分" class="headerlink" title="比特币部分"></a>比特币部分</h4><ul>
<li>密码学基础</li>
<li>比特币的数据结构</li>
<li>共识协议和系统实现</li>
<li>挖矿算法及难度调节</li>
<li>比特币脚本</li>
<li>软分叉和硬分叉</li>
<li>匿名与隐私保护</li>
</ul>
<h4 id="以太坊部分"><a href="#以太坊部分" class="headerlink" title="以太坊部分"></a>以太坊部分</h4><ul>
<li>概述：基于账户的分布式账本</li>
<li>数据结构（MPT）：状态树、交易树、收据树</li>
<li>GHOST协议：对非主链区块的补偿</li>
<li>挖矿：memory hard mining puzzle </li>
<li>权益证明：由POW向POS转变</li>
<li>智能合约</li>
</ul>
<p>总结与展望</p>
<h2 id="比特币部分-1"><a href="#比特币部分-1" class="headerlink" title="比特币部分"></a>比特币部分</h2><h3 id="1-密码学基础"><a href="#1-密码学基础" class="headerlink" title="1.密码学基础"></a>1.密码学基础</h3><p><strong>哈希碰撞：</strong> 简述就是给定hash函数 目前不存在一个方法可以找到满足hash(A) == hash(B) 的 A和B ，即我们无法人为制造hash碰撞。该特性叫做 collision resistance</p>
<p><strong>collision resistance用处：</strong> 给出A，但是由于本性质的缘故，无法反推出A的具体值。</p>
<p><strong>hiding： </strong> 即在给定A和hash函数的条件下，也无法反推出A的取值。</p>
<p><strong>collision resistance和hiding结合实现digital commitment(数据保证)</strong>  如：预测结果为A，提前公布hash(A) , 验证时对A取hash与之对比即可保证发布内容为A，且未提前给出A的信息。</p>
<p><strong>Puzzle friendly：</strong>  想得到某个哈希值，没有什么捷径，只能遍历⼀个个尝试。</p>
<p><strong>对称加密：</strong> 发送前与接收后，使⽤商量好的同⼀个密钥进⾏加密解密。</p>
<p><strong>非对称加密：</strong> A对B传输信息。A使⽤B的公钥加密，B收到后使⽤⾃⼰的私钥解密。公钥相当于银⾏账号，私钥相当于密码。</p>
<p><strong>签名：</strong> A发出交易时⽤A⾃⼰的私钥对信息进⾏签名，然后⽤B的公钥进⾏加密，B收到后⽤B⾃⼰的<br>私钥解密看到信息，⼜可以⽤A的公钥验证签名。</p>
<h3 id="2-BTC的数据结构"><a href="#2-BTC的数据结构" class="headerlink" title="2.BTC的数据结构"></a>2.BTC的数据结构</h3><h5 id="区块链："><a href="#区块链：" class="headerlink" title="区块链："></a>区块链：</h5><blockquote>
<p>区块链结构本身为一条链表，节点为区块。而传统链表实现，便是通过指针将各个节点串联起来而称为最终的链。如下便是我们最常见的一个链表：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200214173054674.png" alt="&gt;[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-G7SWgK0Y-1581672569233)(https://uploadfiles.nowcoder.com/images/20200214/3388381_1581652081601_D7DD1D3DCF48BD4E3FA1E03C1D254097 &quot;图片标题&quot;)]"><br>但在区块链系统中，并未采用指针，而是使用了<strong>哈希指针</strong></p>
<p>每个区块根据自己的区块内容生成自己的哈希值，此外，每个区块（除创世纪块）都保存有<strong>前一个区块的哈希值</strong>。需要注意的是，本区块哈希生成依赖于本区块内容，而本区块内容中又包含有前一个区块的哈希值。从而保证了区块内容不被篡改。</p>
</blockquote>
<h5 id="merkle-tree-默克尔树"><a href="#merkle-tree-默克尔树" class="headerlink" title="merkle tree (默克尔树):"></a>merkle tree (默克尔树):</h5><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200214173821396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>该数据结构的优点在于：只需要记住Root Hash（根哈希值），便可以检测出对树中任何部位的修改。</p>
<p>当需要向轻节点证明某条交易是否被写入区块链，便需要用到Markle proof。我们将交易到根节点这一条路径称为Markle proof，全节点将整个Markle proof发送给轻节点（如下图所示），轻节点即可根据其算出根哈希值，和自己保存的对比，从而验证该交易是否被写入区块链。只要沿着该路径，所有哈希值都正确，说明内容没有被修改过。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200214173621967.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="3-共识机制"><a href="#3-共识机制" class="headerlink" title="3.共识机制"></a>3.共识机制</h3><p><strong>出现的问题：</strong></p>
<p><strong>双花攻击：</strong> 数字货币本身为带有签名的数据文件，可以进行复制。即：对用户来说，可以将同一货币花费两次。</p>
<p>中心化解决办法：对货币添加唯一编号（不可篡改），每次支付向货币发行单位查询真伪。</p>
<p>去中心化解决办法：</p>
<ul>
<li>在比特币系统中由挖矿来决定货币发行权和发行量。</li>
<li>系统维护的一个数据结构，记录货币的使用情况（是否被花过？被谁花过？），即区块链。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200215204645338.png" alt="在这里插入图片描述"></p>
<p>对每一笔交易都可以进行溯源，直到创世纪块的铸币交易。</p>
<p><strong>比特币区块信息</strong></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2021/06/18/3P5isfXWA8onDqM.png" alt="image-20210618215600492"></p>
<blockquote>
<p>挖矿求解问题：Hash（block header）&lt;= target<br>Hash of previous block header只计算区块块头部分的哈希（ Merkle root hash保证了block body内容不被篡改，所以只需要计算block header即可保证整个区块内容不会被篡改）<br>区块链系统中，轻节点（只存储区块block header信息）只利用区块链，但并不参与区块链系统维护和构造。</p>
</blockquote>
<p><strong>分布式共识：</strong> 由于各节点独立完成区块链构建，所以对于账本需要取得一个共识，谁写的帐才是对的？</p>
<p><strong>比特币共识机制：</strong> 谁在组装好区块后对Nonce进行尝试，第一个找到满足Hash(block header) &lt;= target的Nonce的用户便拥有记账权。</p>
<p>为了激励大家参与竞争记账权 避免恶意节点轻易获得记账权，比特币系统设计规定，起初挖掘每个区块可以获得50个比特币，但之后每隔21万个区块，奖励减半。</p>
<p>区块中保存交易记录，那么，会不会存在节点只想发布区块而不想打包交易？中本聪在设计该系统时，引入了交易费。鼓励拥有记账权的区块将交易包含打包发布到区块链中。</p>
<h3 id="4-BTC系统实现"><a href="#4-BTC系统实现" class="headerlink" title="4.BTC系统实现"></a>4.BTC系统实现</h3><blockquote>
<p> 区块链是一个去中心化的账本，比特币采用了 <strong>基于交易的账本模式</strong> 。</p>
<p>系统中并无显示记录账户包含比特币数，实际上其需要通过交易记录进行推算。在比特币系统中，全节点需要维护一个名为 <strong>UTXO(Unspent Transaction Output尚未被花掉的交易输出)</strong> 的数据结构。</p>
<p>如图，A转给B五个BTC，转给C3个BTC，B将5个BTC花掉，则该交易记录不保存在UTXO中，C没有花掉，则该交易记录保存在UTXO中<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200216144427758.png" alt="在这里插入图片描述"></p>
</blockquote>
<p>该结构可以预防双花攻击，判断一个交易是否合法，查询所花的BTC是否在该集合中。该结构由全节点在内存中维护。</p>
<p><strong>区块信息：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200216144715757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>比特币网络：</strong></p>
<p>⼯作在应⽤层application layer：BitCoin Block chain<br>底层network layer：P2P Overlay Network，⽆超级节点⽆主节点，所有节点都平等。<br>设计原则：simple，鲁棒性robust，but not efficient<br>消息传播：泛洪flooding，且不考虑拓扑结构<br>区块⼤⼩字节：1M</p>
<h3 id="5-挖矿算法及难度调节"><a href="#5-挖矿算法及难度调节" class="headerlink" title="5.挖矿算法及难度调节"></a>5.挖矿算法及难度调节</h3><blockquote>
<p>矿工每次组装完一个区块后，尝试Nonce，使Hash(block header)   &lt;= target的过程 叫做挖矿。区块链使用挖矿来争夺记账权，获取出块奖励。</p>
</blockquote>
<p>出块奖励每21w个区块 (4年) 减半。</p>
<p>为防范恶意节点的最长链攻击，最好使用 N confirmation，即在交易后多等几个区块，再确认交易。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://pic.imgdb.cn/item/60ccc1c4844ef46bb2fc8396.jpg" alt="image-20210618235408336"></p>
<p><strong>难度调整</strong><br>挖矿难度和⽬标阈值成反⽐，难度最⼩是1，target很⼤。<br><strong>为何调整挖矿难度</strong><br>出块时间太短造成的问题：分叉成为常态，系统安全性⽆法保证。<br><strong>怎么调整挖矿难度</strong><br>每隔2016个区块(两周)，要调整挖矿难度(target)。<br>target = target X (actual time/expect time)<br>四倍限制(1/4～4)<br>如果有恶意节点到了规定时间不调整，其他诚实结点验证其nBits域不会通过。<br>由于现在挖矿难度加⼤，可能光调整nonce是不够的，还需要调整CoinBase域。<br><strong>挖矿</strong><br>在本地组装⼀个候选区块，⼀边监听⼀边挖(nonce)。如果监听到已经有新的区块产⽣，验证后，停⽌挖<br>矿，在本地重新组装候选区块。<br>memoryless / progress free：由于⽆记忆性，重新挖并不可惜。</p>
<p><strong>⽐特币是如何保证安全性的？</strong><br>共识机制(⼤多数矿⼯是好的) + 密码学(私钥签名)<br><strong>挖矿⼯具(通⽤到专⽤)</strong><br>家⽤电脑cpu：⼤部分内存浪费，cpu⼤部分部件闲置，硬盘闲置<br>GPU(主要⽤于⼤规模并⾏计算)：某些部件也浪费。其他货币有些还在⽤。<br>ASIC芯⽚：Application Specific Integrated Ciral，专⻔设计于挖矿计算hash值</p>
<h3 id="6-比特币脚本"><a href="#6-比特币脚本" class="headerlink" title="6.比特币脚本"></a>6.比特币脚本</h3><blockquote>
<p>比特币系统中使用的脚本语言非常简单，唯一可以访问的内存空间只有栈，所以也被称为“基于栈的语言。</p>
</blockquote>
<ul>
<li>交易的宏观信息：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194054878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>Vin的内容：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194121126.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<p>如果存在 一个交易有多个输入，那么每个输入都要说明币的来源并给出签名（BTC中一个交易可能需要多个签名）</p>
<ul>
<li>Vout的内容：<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194136796.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<ul>
<li>脚本执行：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194341541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>在早期，直接将两个脚本按照如图顺序(input script在前，output script在后) 拼接后执行，后来考虑到安全性问题，两个脚本改为分别执行：先执行input script，若无出错，再执行output script。</p>
<ul>
<li><p><strong>输入输出的几种形式：</strong></p>
<ol>
<li>P2PK形式(Pay to public key)</li>
</ol>
<blockquote>
<p>特点：输出脚本直接给出收款人公钥。(CHECKSIG为检查签名操作)</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020021819451364.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>执行过程：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020021819454353.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ul>
<ol>
<li><p>P2PKH形式(Pay to public key hash)——最常用</p>
<blockquote>
<p>特点：输出脚本不直接给出收款人公钥，而是公钥的哈希。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194613163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>执行过程：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194626894.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194643254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
</ol>
<ol>
<li>P2SH形式(Pay to script hash)</li>
</ol>
<blockquote>
<p>特点：输出脚本给出的不是收款人公钥的哈希，而是收款人提供的一个脚本的哈希。该脚本称为redeemScript,即赎回脚本。等未来花钱的时候，输入脚本要给出redeemScript的具体内容以及可以使之正确运行需要的签名。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200218194710795.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>验证过程：<br>1.验证序列化的redeemScript是否与output script中哈希值匹配。<br>2.反序列化并执行redeemScript，验证iutput script中给出签名是否正确。（将赎回脚本内容当作操作指令执行一遍）<br>redeemScript的形式：<br>1.P2PK形式<br>2.P2PKH形式<br>3.多重签名形式</p>
<h3 id="7-区块链分叉"><a href="#7-区块链分叉" class="headerlink" title="7.区块链分叉"></a>7.区块链分叉</h3><blockquote>
<p>分叉指的是，原来的系统中为一条链，但分成了两条链。分叉形成的原因可能有多种，例如：挖矿时两个节点差不多同时挖出矿，都会发布区块(对比特币系统当前状态产生分歧导致的分叉——state fork)；分叉攻击，同样也会导致分叉(forking attack，人为故意造成)；比特币协议改变，在分布式系统中不能保证所有节点同时升级软件，假设存在少数节点未升级，导致出现分叉(protocal fork)</p>
</blockquote>
<p>根据对比特币协议修改的不同，可以将分叉分为硬分叉和软分叉。</p>
<ul>
<li><p>硬分叉(hard fork)<br>对比特币协议增加新协议，扩展新功能，未升级软件的旧节点会不认可这些修改，会认为这些特性是非法的。这也就是对比特币协议内容产生分歧，从而导致分叉。硬分叉的一个典型例子，就是对比特币区块大小的修改（之前有提到过，BTC区块大小限制1MB，但是否合适存在争议）。</p>
</li>
<li><p>软分叉（soft fork）</p>
<p>对BTC协议添加限制，使得原本合法交易在新交易中不合法，便会形成软分叉。</p>
</li>
</ul>
<p>总结：</p>
<ul>
<li>soft fork<br>特点：只要系统中拥有半数以上算力节点更新软件，系统就不会产生永久性分叉</li>
<li>hard fork<br>特点：必须系统中所有节点更新软件，系统才不会产生永久性分叉</li>
</ul>
<h2 id="以太坊部分-1"><a href="#以太坊部分-1" class="headerlink" title="以太坊部分"></a>以太坊部分</h2><h3 id="1-以太坊概述"><a href="#1-以太坊概述" class="headerlink" title="1.以太坊概述"></a>1.以太坊概述</h3><blockquote>
<p>以太坊便对BTC进行了改进。例如：出块时间、共识协议、mining puzzle（对内存要求高，反ASIC芯片使用）</p>
<p>未来，以太坊还将会用权益证明(POS)替代工作量证明(POW)<br>此外，以太坊增加了对<strong>智能合约（smart contract）</strong>的支持。</p>
</blockquote>
<p>BTC系统是基于交易的账本，系统中并未显示记录账户有多少钱，只能通过UTXO进行推算。</p>
<p>以太坊系统则采用了基于账户的模型，与现实中银行账户相似。系统中显示记录每个账户以太币的数量，转账是否合法只需要查看转账者账户中以太币是否足够即可，同时也不需要每次全部转账。同时，这也也天然地防范了双花攻击。但是存在<strong>重放攻击</strong>的缺陷。</p>
<blockquote>
<p>以太坊系统中存在两类账户：外部账户和合约账户。</p>
</blockquote>
<p><strong>外部账户：</strong>类似于BTC系统中公私钥对。存在账户余额balance和计数器nonce<br><strong>合约账户：</strong>并非通过公私钥对控制。(不能主动发起交易，只能接收到外部账户调用后才能发起交易或调用其他合约账户)其除了balance和nonce之外还有code(代码)、storage(相关状态-存储)<br>创建合约时候会返回一个地址，就可以对其调用。调用过程中，代码不变但状态会发生改变。</p>
<h3 id="2-以太坊数据结构"><a href="#2-以太坊数据结构" class="headerlink" title="2.以太坊数据结构"></a>2.以太坊数据结构</h3><blockquote>
<p>在以太坊中，有<strong>三棵树</strong>的说法，分别是状态树、收据树和交易树。了解了这三棵树，就弄清楚了以太坊的基础数据结构设计。</p>
</blockquote>
<p>merkle tree + 字典树 + 路径压缩 =  MPT(Modified Patricia tree)</p>
<ul>
<li><strong>状态树</strong></li>
</ul>
<p>右上角表示四个账户(为直观，显示较少)和其状态(只显示账户余额)。（需要注意这里的指针都是哈希指针）</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200225193700264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>每次发布新区块，状态树中部分节点状态会改变。但改变并非在原地修改，而是新建一些分支，保留原本状态。如下图中，仅仅有新发生改变的节点才需要修改，其他未修改节点直接指向前一个区块中的对应节点。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200225193719146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>所以，系统中全节点并非维护一棵MPT，而是每次发布新区块都要新建MPT。只不过大部分节点共享。</p>
<blockquote>
<p><strong>最后说明</strong><br>状态树中保存Key-value对，key就是地址，而value状态通过RLP(Recursive Length Prefix，一种进行序列化的方法)编码序列号之后再进行存储。</p>
</blockquote>
<ul>
<li><strong>交易树和收据树</strong></li>
</ul>
<blockquote>
<p> 每次发布一个区块时，区块中的交易会形成一颗Merkle Tree，即交易树。</p>
<p>每个交易执行完之后形成一个收据，记录交易相关信息。也就是说，交易树和收据树上的节点是一一对应的。</p>
</blockquote>
<p>交易树和收据树只将当前区块中的交易组织起来，而状态树将所有账户的状态都包含进去，无论这些账户是否与当前区块中交易有关系。<br>多个区块状态树共享节点，而交易树和收据树依照区块独立。</p>
<p>交易树和收据树的用途：</p>
<ol>
<li>向轻节点提供Merkle Proof。</li>
<li>更加复杂的查找操作(例如：查找过去十天的交易；过去十天的众筹事件等)</li>
</ol>
<ul>
<li><strong>bloom filter 布隆过滤器</strong></li>
</ul>
<p>支持较为高效查找某个元素是否在某个集合中<br>方法：给一个大的集合，计算出一个紧凑的“摘要”，可以迅速过滤区块链中不包含xxx的区块</p>
<h3 id="3-以太坊的GHOST协议"><a href="#3-以太坊的GHOST协议" class="headerlink" title="3.以太坊的GHOST协议"></a>3.以太坊的GHOST协议</h3><blockquote>
<p>前景提要：BTC系统中出块时间为10min，而以太坊中出块时间被降低到15s左右，虽然有效提高了系统反应时间和吞吐率，却也导致系统临时性分叉变成常态，且分叉数目更多。由于系统中经常性会出现分叉，则矿工挖到矿很大可能会被废弃，这会大大降低矿工挖矿积极性。</p>
<p>所以，以太坊设计了新的公式协议——<code>GHOST协议</code>(该协议并非原创，而是对原本就有的Ghost协议进行了改进)。</p>
</blockquote>
<p>对于出块成功，且未成为最长合法链的区块，被后续最长合法链区块称为<strong>叔父区块</strong>。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200228133558197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>规定E区块在发布时可以将A、C、D叔父区块包含进来，A、C、D叔父区块可以得到出块奖励的7/8，而为了激励E包含叔父区块，规定E每包含一个叔父区块可以额外得到1/32的出块奖励。为了防止E大量包含叔父区块，规定一个区块只能最多包含两个叔父区块，因此E在A、C、D中最多只能包含两个区块作为自己的出块奖励</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020022813374149.png" alt="在这里插入图片描述"></p>
<p>叔父区块的定义是和当前区块在七代之内有共同祖先才可，对于M来说，无论包含哪个辈分的“叔父”，得到的出块奖励都是1/32出块奖励。这样，就方便了全节点进行记录，此外，也从协议上鼓励一旦出现分叉马上进行合并。</p>
<p>需要注意的是，ETH的区块奖励并不会递减，uncle block中的交易也并不会被执行。</p>
<h3 id="4-以太坊的挖矿算法"><a href="#4-以太坊的挖矿算法" class="headerlink" title="4.以太坊的挖矿算法"></a>4.以太坊的挖矿算法</h3><blockquote>
<p>挖矿这一过程，虽然并没有创造什么实际价值，但挖矿本身维持了比特币系统的稳定。总体来说，比特币系统中的挖矿算法较为成功，并未发现大的漏洞。</p>
</blockquote>
<p>前景提要：BTC的挖矿算法导致了挖矿设备的专业化，普通计算机用户难以参与进去，导致了挖矿中心化的局面产生，而这与“去中心化”这一理念相违背。</p>
<p>所以，后续的加密货币希望针对ASIC矿机，推出增加对内存访问的需求的挖矿算法。</p>
<ul>
<li><p>莱特币挖矿算法概述</p>
<ol>
<li><p>设置一个很大的数组，按照顺序填充伪随机数。Seed为种子节点，通过Seed进行一些运算获得第一个数，之后每个数字都是通过前一个位置的值取哈希得到的。这样的数组中取值存在前后依赖关系。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200228171425644.png" alt="在这里插入图片描述"></p>
</li>
<li><p>在需要求解Puzzle的时候，按照伪随机顺序，从数组中读取一些数，每次读取位置与前一个数相关。例如：第一次，从A位置读取其中数据，根据A中数据计算获得下一次读取位置B；第二次,从B位置读取其中数据，根据B中数据计算获得下一次读取位置C；</p>
</li>
</ol>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200228171439422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>总结：如果数组足够大，对于挖矿矿工来说，必须保存该数组以便查询，否则每次不仅计算位置，还要根据Seed计算整个数组数据，才能查询到对应位置的数据。这对于矿工来说，计算复杂度大幅度上升。</p>
<ul>
<li>以太坊挖矿算法概述</li>
</ul>
<blockquote>
<p>以太坊中，设计了两个数据集，一大一小。小的为16MB的cache，大的数据集为1G的dataset(DAG)。其关系为，1G的数据集是通过16MB数据集生成而来的。</p>
<p>为了便于进行验证，轻节点保存16MB的Cache进行验证即可。</p>
<p>而矿工为了挖矿更快，减少重复计算则需要存储1GB大小的大数据集。</p>
</blockquote>
<p>以太坊挖矿过程：</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200228171549400.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>根据区块block header和其中的Nonce值计算一个初始哈希，根据其映射到某个初始位置A，读取A位置的数及其相邻的后一个位置A’上的数,根据该两个数进行运算，算得下一个位置B，读取B和B’位置上的数，依次类推，迭代读取64次，共读取128个数。</p>
<p>最后，计算出一个哈希值与挖矿难度目标阈值比较，若不符合就重新更换Nonce，重复以上操作直到最终计算哈希值符合难度要求或当前区块已经被挖出。</p>
</blockquote>
<p>具体部分有兴趣者，自行了解。</p>
<h3 id="5-权益证明"><a href="#5-权益证明" class="headerlink" title="5.权益证明"></a>5.权益证明</h3><blockquote>
<p>按照所占权益投票进行共识达成，类似于股份制有限共识按照股份多少投票，权益证明不需要挖矿。</p>
<p>还有吓唬矿机厂商，减少ASIC矿机研发的功能。</p>
</blockquote>
<p>在设计之初，以太坊开发者就设想要从POW转向POS，并为了防止有矿工不愿意转埋下了一颗“难度炸弹”。即ETH的挖矿难度在呈指数级增加。</p>
<p>预挖矿(pre mining) ： 开发以太坊时，给开发者预留了一部分货币。</p>
<p>Pre-Sale： 将预留的货币出售掉用于后续开发，类似于拉风投或众筹。</p>
<h3 id="6-智能合约"><a href="#6-智能合约" class="headerlink" title="6.智能合约"></a>6.智能合约</h3><p><strong>智能合约</strong>：运行在区块链系统上的一段代码，代码逻辑定义了合约内容。<br>智能合约的账户保存了合约当前的运行状态：</p>
<ul>
<li>balance：当前余额</li>
<li>nonce：交易次数</li>
<li>code：合约代码</li>
<li>storage：存储，数据结构为一棵MPT</li>
</ul>
<p>智能合约编写代码为<code>Solidity</code>，其语法与JavaScript很接近。<br>下图显示了智能合约的代码结构。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200304162806439.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li><strong>外部账户调用合约账户</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200304191834619.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li><p><strong>合约账户调用合约账户</strong></p>
<ol>
<li><strong>直接调用</strong></li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200304192100140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>错误处理：直接调用的方式，一方产生异常会导致另一方也进行回滚操作。</p>
</li>
</ul>
<ol>
<li><p><strong>address调用</strong></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200304192237645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>错误处理：address.call()的方法，如果调用过程中被调用合约产生异常，会导致call()返回false，但发起调用的函数不会抛出异常，而是继续执行。</p>
</li>
</ol>
<ol>
<li><p><strong>代理调用</strong></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/2020030419262145.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>和call()调用基本一致，区别在于其并不会切入被调用合约的上下文中。</p>
</li>
</ol>
<ul>
<li><p><strong>Payable</strong> ：如果一个函数可以接收外部转账，则必须标记为payable</p>
</li>
<li><p><strong>fallback 函数：</strong> </p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200305112942373.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>​        该函数主要是防止A向B转账，但没有在data域中说明要调用哪个函数或说明的要调用函数不存在，此时调用fallback()函数。</p>
<ul>
<li><p><strong>智能合约创建与运行：</strong></p>
<blockquote>
<p>实际上并不是想转账，而是想要创建智能合约。EVM设计思想类似 于JAVA中的JVM，便于跨平台增强可移植性。EVM中寻址空间256位，而目前个人机主流位32位和64位，与之存在较大差距。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200306151126702.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</blockquote>
<p>以太坊规定，执行合约中指令需要收取汽油费，并且由发起交易的人进行支付。</p>
</li>
<li><p><strong>错误处理</strong></p>
<p>以太坊中交易具有原子性，要么全执行，要么全不执行，不会只执行一部分(包含智能合约)。<br>需要注意的是，在执行过程中产生错误导致回滚，已经消耗掉的汽油费是不会退回的。从而有效防止了恶意节点对全节点进行恶意调用。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200309145241517.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://img-blog.csdnimg.cn/20200306153636245.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L011X1hpYW95ZQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>嵌套调用是否发生回滚，取决于调用方式。一个合约向一个合约账户直接转账，因为fallback函数的存在，仍有可能会引发嵌套调用。</p>
</li>
</ul>
<p>后续完整智能合约内容参见Solidity教程。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由中本聪的BTC引发了去中心化的开端，后面应运而生各种为了解决BTC的问题的各种币，但是直到ETH之前都还是未脱俗。ETH的诞生宣告区块链除了虚拟货币外的其他应用场景。抛去去中心化这个帽子，我们要时常与世界所接触，技术不只是浮于名词表面更要实际的与社会实践所接触，发挥他应有的价值。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">kid1999</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://kid1999.github.io/2021/06/18/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80/">http://kid1999.github.io/2021/06/18/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://kid1999.github.io" target="_blank">Kid1999' Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/BTC/">BTC</a><a class="post-meta__tags" href="/tags/ETH/">ETH</a></div><div class="post_share"><div class="social-share" data-image="https://puui.qpic.cn/fans_admin/0/3_1680187318_1573908333220/0" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/"/></a><div class="post-qr-code-desc"></div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/20/Solidity%E5%9F%BA%E7%A1%80/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://ae01.alicdn.com/kf/H33551ca5d3844b86a66fab8a09f02af7e.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Solidity基础</div></div></a></div><div class="next-post pull-right"><a href="/2021/04/01/Electron-Vue%E8%81%94%E5%8A%A8%E5%BC%80%E5%8F%91/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://ae01.alicdn.com/kf/H33551ca5d3844b86a66fab8a09f02af7e.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Electron-Vue联动开发</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://ae01.alicdn.com/kf/H340f46b2cafd47248f643b32d3629cc3d.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">kid1999</div><div class="author-info__description">一位计科学生的杂学手记。</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">111</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">85</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/kid1999"><i class="fab fa-github"></i><span>点个关注</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">感谢访问，若喜欢请收藏 ^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">区块链基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">目录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E7%89%B9%E5%B8%81%E9%83%A8%E5%88%86"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">比特币部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E9%83%A8%E5%88%86"><span class="toc-number">1.1.0.2.</span> <span class="toc-text">以太坊部分</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E7%89%B9%E5%B8%81%E9%83%A8%E5%88%86-1"><span class="toc-number">1.2.</span> <span class="toc-text">比特币部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AF%86%E7%A0%81%E5%AD%A6%E5%9F%BA%E7%A1%80"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.密码学基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-BTC%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.BTC的数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE%EF%BC%9A"><span class="toc-number">1.2.2.0.1.</span> <span class="toc-text">区块链：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#merkle-tree-%E9%BB%98%E5%85%8B%E5%B0%94%E6%A0%91"><span class="toc-number">1.2.2.0.2.</span> <span class="toc-text">merkle tree (默克尔树):</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">3.共识机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-BTC%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.2.4.</span> <span class="toc-text">4.BTC系统实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%8C%96%E7%9F%BF%E7%AE%97%E6%B3%95%E5%8F%8A%E9%9A%BE%E5%BA%A6%E8%B0%83%E8%8A%82"><span class="toc-number">1.2.5.</span> <span class="toc-text">5.挖矿算法及难度调节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%AF%94%E7%89%B9%E5%B8%81%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.6.</span> <span class="toc-text">6.比特币脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%8C%BA%E5%9D%97%E9%93%BE%E5%88%86%E5%8F%89"><span class="toc-number">1.2.7.</span> <span class="toc-text">7.区块链分叉</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E9%83%A8%E5%88%86-1"><span class="toc-number">1.3.</span> <span class="toc-text">以太坊部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.以太坊概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.以太坊数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84GHOST%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.以太坊的GHOST协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E6%8C%96%E7%9F%BF%E7%AE%97%E6%B3%95"><span class="toc-number">1.3.4.</span> <span class="toc-text">4.以太坊的挖矿算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9D%83%E7%9B%8A%E8%AF%81%E6%98%8E"><span class="toc-number">1.3.5.</span> <span class="toc-text">5.权益证明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-number">1.3.6.</span> <span class="toc-text">6.智能合约</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/12/07/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93/" title="强化学习常见算法总结">强化学习常见算法总结</a><time datetime="2021-12-07T11:52:17.000Z" title="发表于 2021-12-07 19:52:17">2021-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/12/05/k8s%E7%AE%80%E8%AE%B0/" title="k8s简记">k8s简记</a><time datetime="2021-12-05T12:44:27.000Z" title="发表于 2021-12-05 20:44:27">2021-12-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/12/02/%E5%8C%BA%E5%9D%97%E9%93%BE%E8%B7%A8%E9%93%BE%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/" title="区块链跨链方案分析">区块链跨链方案分析</a><time datetime="2021-12-02T11:12:15.000Z" title="发表于 2021-12-02 19:12:15">2021-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/11/16/%E5%AF%B9USDT%E7%9A%84%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/" title="ETH的信息访问">ETH的信息访问</a><time datetime="2021-11-16T06:57:42.000Z" title="发表于 2021-11-16 14:57:42">2021-11-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/10/26/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE%E4%B9%8BPbft%E7%AE%97%E6%B3%95/" title="分布式一致性协议之Pbft算法">分布式一致性协议之Pbft算法</a><time datetime="2021-10-26T15:20:52.000Z" title="发表于 2021-10-26 23:20:52">2021-10-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 By kid1999</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>